# ---------------------------------------------------
# Auto-Restore Backup from Google Drive
# ---------------------------------------------------

# ⚠️ ضع هنا "معرف الملف" (File ID) الذي أخذته من الرابط
:local fileID "1Tk4pW0xZObeeLQOrZOyDUIlFFrfHaw7p"

# ⚠️ إذا كان لملف الباك أب باسورد، اكتبه هنا (وإلا اتركه فارغاً)
:local backupPass "8008"

# اسم الملف الذي سنحفظه في الميكروتيك
:local fileName "downloaded_backup.backup"

# رابط التحميل المباشر من جوجل (لا تغير هذا السطر)
:local url "https://drive.google.com/uc?export=download&id=$fileID"

:log warning "G-Drive Restore: Starting download..."

# 1. التحميل من جوجل درايف
# نستخدم check-certificate=no لأن شهادات جوجل أحياناً لا يتعرف عليها الميكروتيك القديم
:do {
    /tool fetch url=$url dst-path=$fileName mode=https check-certificate=no keep-result=yes
    :delay 5s
} on-error={
    :log error "G-Drive Restore: Download FAILED! Check File ID or Internet."
    :error "Stop"
}

# 2. التأكد من حجم الملف (لضمان أنه ليس ملف خطأ HTML)
# ملفات الباك أب عادة أكبر من 10 كيلوبايت
:if ([:len [/file find name=$fileName]] > 0) do={
    :local fileSize [/file get $fileName size]
    
    :if ($fileSize > 5000) do={
        :log warning "G-Drive Restore: File downloaded successfully ($fileSize bytes)."
        :log warning "G-Drive Restore: Restoring configuration in 5 seconds... (Router will REBOOT)"
        :delay 5s
        
        # 3. استعادة النسخة (سيقوم بإعادة التشغيل فوراً)
        /system backup load name=$fileName password=$backupPass
        
    } else={
        :log error "G-Drive Restore: File is too small! Maybe Google Drive permission error?"
    }
} else={
    :log error "G-Drive Restore: File not found after fetch!"
}
